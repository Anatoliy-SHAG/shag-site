<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mining 1SHAG — 150 SHAG/доба, клейм по 100</title>
  <style>
    body{margin:0;background:#0f172a;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
    header{display:flex;align-items:center;justify-content:center;gap:12px;padding:18px 12px}
    header img{width:60px;height:60px}
    h1{margin:0;font-size:28px}
    .wrap{max-width:900px;margin:0 auto;padding:12px}
    .panel{background:#111c36;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .stat{font-size:20px;margin:8px 0}
    .btn{display:block;width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);margin:8px 0;font-weight:700;cursor:pointer}
    .start{background:#22c55e}.stop{background:#ef4444}.claim{background:#3b82f6}.wallet{background:#a78bfa}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .bar{height:12px;background:#0b1226;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.12)}
    .bar>div{height:100%;background:linear-gradient(90deg,#00e0a6,#3ba3ff);width:0%}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:700px){.row{grid-template-columns:1fr}}
    .muted{color:#aab7d4;font-size:14px}
    code{background:#0b1226;border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:6px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <header>
    <img src="logo.png" alt="1SHAG logo" onerror="this.style.display='none'">
    <h1>Mining 1SHAG</h1>
  </header>

  <div class="wrap">
    <div class="panel">
      <div class="row">
        <div>
          <div class="stat">Нарахування: <b>≈150 SHAG / 24 год</b></div>
          <div class="stat">Баланс (локально): <b><span id="bal">0.000000</span> SHAG</b></div>
          <div class="bar"><div id="bar"></div></div>
          <button id="startBtn" class="btn start">Старт</button>
          <button id="stopBtn" class="btn stop" disabled>Пауза</button>
          <button id="claimBtn" class="btn claim" disabled>Клейм 100 SHAG</button>
          <button id="walletBtn" class="btn wallet">Підключити гаманець</button>
          <div class="muted">Це хмарний майнінг. Клейм викликає смартконтракт faucet, який відправляє <b>100 SHAG</b> на адресу.</div>
        </div>
        <div>
          <div class="muted">
            Контракт токена: <code id="tokenAddr">0x38040A7763da2f4aF94fefB0922A3F4Bd5B91772</code><br>
            Адреса faucet: <code id="faucetAddr">0xfbF161d7Fcf3984B1562EBf84866E1fb90aA4548</code><br>
            Мін. клейм: <b>100 SHAG</b> · Мережа: <b>BSC</b> (трохи BNB для газу)
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/** ===== Налаштування адрес ===== */
const TOKEN  = "0x38040A7763da2f4aF94fefB0922A3F4Bd5B91772";
const FAUCET = "0xfbF161d7Fcf3984B1562EBf84866E1fb90aA4548";

/** ===== Параметри майнінгу (локальна симуляція) ===== */
const MIN_LOCAL = 100;                // клейм доступний від 100
const EARN_RATE = 150 / 86400;        // 150 SHAG за 24 години

let running = false, last = null;
let bal = parseFloat(localStorage.getItem('shag_local_bal') || '0');

const balEl   = document.getElementById('bal');
const barEl   = document.getElementById('bar');
const startBtn= document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const claimBtn= document.getElementById('claimBtn');
const walletBtn=document.getElementById('walletBtn');

function updUI(){
  balEl.textContent = bal.toFixed(6);
  barEl.style.width = Math.min(100, (bal % 100)) + '%';
  claimBtn.disabled = !(bal >= MIN_LOCAL);
}
updUI();

function loop(ts){
  if(!running){ last = ts; return; }
  if(last === null) last = ts;
  const dt = (ts - last) / 1000; // сек
  last = ts;
  bal += EARN_RATE * dt;
  localStorage.setItem('shag_local_bal', bal);
  updUI();
  requestAnimationFrame(loop);
}

startBtn.onclick = () => { running = true; startBtn.disabled = true; stopBtn.disabled = false; requestAnimationFrame(loop); };
stopBtn.onclick  = () => { running = false; startBtn.disabled = false; stopBtn.disabled = true; };

/** ===== Робота з гаманцем та Faucet ===== */
const faucetAbi = [
  {"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

async function connect(){
  if(!window.ethereum){
    alert("Відкрий сторінку в браузері з MetaMask або Trust Wallet.");
    return null;
  }
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send('eth_requestAccounts',[]);
  const signer = provider.getSigner();
  const addr   = await signer.getAddress();

  // додатково: підказати, якщо не BSC mainnet
  try {
    const net = await provider.getNetwork();
    if (net.chainId !== 56) {
      alert("У MetaMask вибери мережу BNB Smart Chain (Mainnet, ChainId 56).");
    }
  } catch {}
  return { provider, signer, addr };
}

walletBtn.onclick = async () => {
  const c = await connect();
  if (c) alert("Гаманець підключено: " + c.addr);
};

claimBtn.onclick = async () => {
  if (bal < MIN_LOCAL) return;
  try {
    const ctx = await connect();
    if(!ctx) return;

    if (!confirm("Клейм 100 SHAG на " + ctx.addr + "?")) return;

    const faucet = new ethers.Contract(FAUCET, faucetAbi, ctx.signer);

    // Спроба оцінити газ. Якщо не вдасться — ставимо ручний запас.
    let overrides = {};
    try {
      const est = await faucet.estimateGas.claim();
      overrides.gasLimit = est.mul(12).div(10); // +20% запасу
    } catch {
      overrides.gasLimit = 180000;             // ручний ліміт
    }

    const tx = await faucet.claim(overrides);
    alert("Підтверди транзакцію в MetaMask. Tx: " + tx.hash);
    await tx.wait();

    bal = bal - 100;
    localStorage.setItem('shag_local_bal', bal);
    updUI();
    alert("Готово! 100 SHAG відправлено на твій гаманець.");
  } catch (e) {
    const msg = e?.reason || e?.error?.message || e?.message || String(e);
    alert("Помилка клейму: " + msg);
  }
};

// первинне відображення адрес на сторінці
document.getElementById('tokenAddr').textContent  = TOKEN;
document.getElementById('faucetAddr').textContent = FAUCET;
</script>
</body>
</html>
