<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>1SHAG –ú–∞–π–Ω—ñ–Ω–≥-—Ñ–µ—Ä–º–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="logo.png.png" />

  <!-- Ethers.js –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –≥–∞–º–∞–Ω—Ü–µ–º —Ç–∞ —Å–º–∞—Ä—Ç–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #26263a 0, #050509 45%, #000000 100%);
      color: #f5f5f5;
    }

    .wrapper {
      width: 100%;
      max-width: 520px;
      padding: 16px;
    }

    .card {
      width: 100%;
      background: radial-gradient(circle at top, #181825 0, #070710 55%, #030307 100%);
      border-radius: 22px;
      padding: 20px 18px 18px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 215, 0, 0.22);
      position: relative;
      overflow: hidden;
    }

    /* –§–æ–Ω–æ–≤–∞ —Å—ñ—Ç–∫–∞ */
    .bg-rack {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.06;
      background-image:
        linear-gradient(90deg, rgba(255, 255, 255, 0.18) 1px, transparent 1px),
        linear-gradient(180deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
      background-size: 46px 46px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 1;
      margin-bottom: 12px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 12px;
      color: #c6c6d8;
    }

    .wallet-btn {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      border: 1px solid #3b3b5a;
      background: #12121c;
      color: #f5f5f5;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .wallet-btn:hover {
      border-color: #f1c550;
      box-shadow: 0 0 0 1px rgba(241, 197, 80, 0.4);
    }

    .wallet-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ff8080;
    }

    .wallet-dot.ok {
      background: #9be38b;
    }

    .wallet-dot.warn {
      background: #f5d26c;
    }

    .center {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    /* –ú–æ–Ω–µ—Ç–∞ SHAG ‚Äî –Ü–ó –¢–í–û–ì–û –õ–û–ì–û */
    .coin-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .coin-image-wrapper {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      padding: 4px;
      background: radial-gradient(circle at 30% 20%, #fff6cb 0, #f3cf74 30%, #b67820 70%, #3a2107 100%);
      box-shadow:
        0 0 0 2px rgba(0, 0, 0, 0.9),
        0 4px 14px rgba(0, 0, 0, 0.9),
        0 0 26px rgba(255, 215, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: coin-sway 8s ease-in-out infinite;
    }

    .coin-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
    }

    @keyframes coin-sway {
      0%   { transform: rotateY(0deg); }
      50%  { transform: rotateY(4deg); }
      100% { transform: rotateY(0deg); }
    }

    /* –§–µ—Ä–º–∞ ‚Äî —Ä–∏–≥–∏, –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∏, –ª–∞–º–ø–æ—á–∫–∏ */
    .farm {
      width: 100%;
      max-width: 380px;
      margin-top: 4px;
      margin-bottom: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rig-row {
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .rig {
      flex: 1;
      min-width: 0;
      background: linear-gradient(145deg, #101020, #05050b);
      border-radius: 11px;
      border: 1px solid rgba(120, 130, 180, 0.6);
      padding: 4px 6px 5px;
      box-shadow:
        0 3px 8px rgba(0, 0, 0, 0.7),
        inset 0 0 10px rgba(0, 0, 0, 0.75);
      position: relative;
      overflow: hidden;
    }

    .rig-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .rig-name {
      font-size: 9px;
      text-transform: uppercase;
      color: #a6a9d0;
      letter-spacing: 0.14em;
    }

    .rig-leds {
      display: flex;
      gap: 3px;
      align-items: center;
    }

    .rig-led {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #333548;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.7);
    }

    .rig-led--green {
      background: #68ff9a;
      box-shadow: 0 0 6px rgba(104, 255, 154, 0.9);
      animation: ledPulseGreen 2.4s ease-in-out infinite;
    }

    .rig-led--amber {
      background: #ffd86a;
      box-shadow: 0 0 6px rgba(255, 216, 106, 0.9);
      animation: ledPulseAmber 3.1s ease-in-out infinite;
    }

    .rig-led--blue {
      background: #7fd2ff;
      box-shadow: 0 0 6px rgba(127, 210, 255, 0.9);
      animation: ledPulseBlue 3.6s ease-in-out infinite;
    }

    @keyframes ledPulseGreen {
      0%, 100% { opacity: 0.5; }
      50%      { opacity: 1; }
    }

    @keyframes ledPulseAmber {
      0%, 100% { opacity: 0.4; }
      40%      { opacity: 1; }
    }

    @keyframes ledPulseBlue {
      0%, 100% { opacity: 0.4; }
      60%      { opacity: 1; }
    }

    .rig-body {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      align-items: center;
    }

    .fan {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #3e435f;
      box-shadow:
        inset 0 0 6px rgba(0, 0, 0, 0.9),
        0 0 6px rgba(110, 144, 220, 0.75);
      position: relative;
      overflow: hidden;
      animation: fanSpin 1.8s linear infinite;
    }

    .fan-blade {
      position: absolute;
      width: 55%;
      height: 6%;
      background: #a9b4ff;
      top: 47%;
      left: 22%;
      transform-origin: 50% 50%;
      opacity: 0.95;
    }

    .fan-blade:nth-child(2) { transform: rotate(90deg); }
    .fan-blade:nth-child(3) { transform: rotate(180deg); }
    .fan-blade:nth-child(4) { transform: rotate(270deg); }

    @keyframes fanSpin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .rig-temp {
      font-size: 9px;
      color: #a6a9d0;
      text-align: right;
      line-height: 1.4;
    }

    .rig-temp span {
      color: #ffb26a;
      font-weight: 600;
    }

    .panel-label {
      font-size: 11px;
      color: #d7cfa9;
      margin-bottom: 4px;
    }

    .counter {
      width: 100%;
      background: #0d0d18;
      border-radius: 12px;
      border: 1px solid #343454;
      padding: 8px 10px;
      text-align: center;
      margin-bottom: 8px;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.85);
    }

    .counter-value {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.04em;
      font-family: "Courier New", monospace;
      color: #ffe9a3;
    }

    .counter-unit {
      font-size: 12px;
      color: #d7cfa9;
      margin-left: 4px;
    }

    .speed {
      font-size: 11px;
      color: #9f9fc0;
      margin-top: 2px;
    }

    .progress-wrap {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 4px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #181826;
      overflow: hidden;
      border: 1px solid #343454;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #f1c550, #b8741a);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
      transition: width 0.25s ease-out;
    }

    .status {
      font-size: 12px;
      margin-top: 6px;
      text-align: center;
    }

    .status-ok {
      color: #9be38b;
    }

    .status-warn {
      color: #f5d26c;
    }

    .status-error {
      color: #ff8989;
    }

    .claim-btn {
      margin-top: 14px;
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor: pointer;
      background: linear-gradient(135deg, #f1c550, #b8741a);
      color: #231407;
      box-shadow:
        0 10px 20px rgba(0, 0, 0, 0.7),
        0 0 12px rgba(255, 215, 0, 0.8);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.1s;
    }

    .claim-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow:
        0 14px 26px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(255, 215, 0, 0.9);
      filter: brightness(1.05);
    }

    .claim-btn:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow:
        0 6px 14px rgba(0, 0, 0, 0.8),
        0 0 11px rgba(255, 215, 0, 0.8);
    }

    .claim-btn:disabled {
      cursor: default;
      opacity: 0.6;
      box-shadow: none;
    }

    .timer {
      margin-top: 8px;
      font-size: 11px;
      text-align: center;
      color: #9f9fc0;
    }

    .info {
      margin-top: 10px;
      font-size: 11px;
      text-align: center;
      color: #7f8094;
      line-height: 1.4;
    }

    .small {
      font-size: 10px;
      color: #666885;
    }

    @media (max-width: 480px) {
      .card {
        padding: 18px 14px 14px;
      }

      .counter-value {
        font-size: 20px;
      }

      .farm {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
<div class="wrapper">
  <div class="card">
    <div class="bg-rack"></div>

    <div class="header">
      <div class="title-block">
        <div class="title">1SHAG –ú–∞–π–Ω—ñ–Ω–≥-—Ñ–µ—Ä–º–∞</div>
        <div class="subtitle">–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π Faucet 1SHAG –∑ –ª—ñ–º—ñ—Ç–æ–º 100 SHAG / 24 –≥–æ–¥.</div>
      </div>
      <button id="connectBtn" class="wallet-btn">
        <span class="wallet-dot" id="walletDot"></span>
        <span id="walletLabel">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≥–∞–º–∞–Ω–µ—Ü—å</span>
      </button>
    </div>

    <div class="center">
      <div class="coin-wrap">
        <div class="coin-image-wrapper">
          <img src="logo.png.png" alt="–ú–æ–Ω–µ—Ç–∞ SHAG" class="coin-image" />
        </div>
      </div>

      <div class="farm">
        <div class="rig-row">
          <div class="rig">
            <div class="rig-header">
              <div class="rig-name">RIG-01</div>
              <div class="rig-leds">
                <div class="rig-led rig-led--green"></div>
                <div class="rig-led rig-led--amber"></div>
                <div class="rig-led rig-led--blue"></div>
              </div>
            </div>
            <div class="rig-body">
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="rig-temp">
                –¢–µ–º–ø:<br><span>100 SHAG/24h</span>
              </div>
            </div>
          </div>
          <div class="rig">
            <div class="rig-header">
              <div class="rig-name">RIG-02</div>
              <div class="rig-leds">
                <div class="rig-led rig-led--green"></div>
                <div class="rig-led rig-led--amber"></div>
                <div class="rig-led rig-led--blue"></div>
              </div>
            </div>
            <div class="rig-body">
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="rig-temp">
                –°—Ç–∞—Ç—É—Å:<br><span>Online</span>
              </div>
            </div>
          </div>
        </div>

        <div class="rig-row">
          <div class="rig">
            <div class="rig-header">
              <div class="rig-name">RIG-03</div>
              <div class="rig-leds">
                <div class="rig-led rig-led--green"></div>
                <div class="rig-led rig-led--amber"></div>
              </div>
            </div>
            <div class="rig-body">
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="fan">
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
                <div class="fan-blade"></div>
              </div>
              <div class="rig-temp">
                –ú–µ—Ä–µ–∂–∞:<br><span>BSC</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div style="width: 100%; max-width: 380px;">
        <div class="panel-label">–õ—ñ—á–∏–ª—å–Ω–∏–∫ –≤–∏–¥–æ–±—É—Ç–∫—É</div>
        <div class="counter">
          <span id="counterValue" class="counter-value">0.00000000</span>
          <span class="counter-unit">SHAG</span>
          <div class="speed" id="speedInfo">–®–≤–∏–¥–∫—ñ—Å—Ç—å: 100 SHAG / 24 –≥–æ–¥–∏–Ω–∏</div>
        </div>

        <div class="progress-wrap">
          <div class="panel-label">–ü—Ä–æ–≥—Ä–µ—Å –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è</div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>

        <div id="statusText" class="status status-warn">
          –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å —É –º–µ—Ä–µ–∂—ñ BNB Smart Chain, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏.
        </div>

        <button id="claimBtn" class="claim-btn" disabled>
          –û–¢–†–ò–ú–ê–¢–ò 100 SHAG
        </button>

        <div id="timerText" class="timer">
          –î–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: 24:00:00
        </div>

        <div class="info">
          –ë–∞–ª–∞–Ω—Å Faucet —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Å–º–∞—Ä—Ç–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ. <br />
          –£—Å—ñ –≤–∏–ø–ª–∞—Ç–∏ –ø—Ä–æ–∑–æ—Ä—ñ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ BscScan.
          <div class="small" id="faucetInfo"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ================== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ê–î–†–ï–° ==================
  const TOKEN_ADDRESS = "0x38040A7763da2f4aF94fefB0922A3F4Bd5B91772"; // 1SHAG
  const FAUCET_ADDRESS = "0x0000000000000000000000000000000000000000"; // üî¥ –ó–ê–ú–Ü–ù–ò –ù–ê –ê–î–†–ï–°–£ ShagFaucet
  const TOKEN_DECIMALS = 18;

  const TOKEN_ABI = [
    "function balanceOf(address) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ];

  const FAUCET_ABI = [
    "function rewardAmount() view returns (uint256)",
    "function claimInterval() view returns (uint256)",
    "function isPaused() view returns (bool)",
    "function lastClaimTime(address) view returns (uint256)",
    "function faucetBalance() view returns (uint256)",
    "function canClaim(address) view returns (bool)",
    "function claim()",
    "event Claimed(address indexed user, uint256 amount, uint256 timestamp)"
  ];

  let provider;
  let signer;
  let userAddress = null;
  let tokenContract;
  let faucetContract;

  let rewardAmountBN = null;
  let claimIntervalSec = 24 * 60 * 60;
  let lastClaimTimeSec = 0;
  let isPaused = false;
  let faucetBalanceBN = null;

  let miningTimer = null;

  const connectBtn = document.getElementById("connectBtn");
  const walletDot = document.getElementById("walletDot");
  const walletLabel = document.getElementById("walletLabel");
  const counterValueEl = document.getElementById("counterValue");
  const progressFillEl = document.getElementById("progressFill");
  const statusTextEl = document.getElementById("statusText");
  const claimBtn = document.getElementById("claimBtn");
  const timerTextEl = document.getElementById("timerText");
  const faucetInfoEl = document.getElementById("faucetInfo");

  function setStatus(message, type = "warn") {
    statusTextEl.textContent = message;
    statusTextEl.className = "status " + (type === "ok" ? "status-ok" : type === "error" ? "status-error" : "status-warn");
  }

  function setWalletIndicator(status, text) {
    walletLabel.textContent = text;
    walletDot.classList.remove("ok", "warn");
    if (status === "ok") walletDot.classList.add("ok");
    if (status === "warn") walletDot.classList.add("warn");
  }

  function formatTimeLeft(sec) {
    if (sec <= 0) return "00:00:00";
    const h = String(Math.floor(sec / 3600)).padStart(2, "0");
    const m = String(Math.floor((sec % 3600) / 60)).padStart(2, "0");
    const s = String(sec % 60).padStart(2, "0");
    return `${h}:${m}:${s}`;
  }

  function trimTo8Decimals(str) {
    if (!str.includes(".")) return str + ".00000000";
    const [whole, frac] = str.split(".");
    const frac8 = (frac + "00000000").slice(0, 8);
    return `${whole}.${frac8}`;
  }

  async function initProvider() {
    if (!window.ethereum) {
      setStatus("–ì–∞–º–∞–Ω–µ—Ü—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask –∞–±–æ —Å—É–º—ñ—Å–Ω–∏–π –≥–∞–º–∞–Ω–µ—Ü—å.", "error");
      return false;
    }
    provider = new ethers.providers.Web3Provider(window.ethereum);
    return true;
  }

  async function checkNetwork() {
    const network = await provider.getNetwork();
    if (network.chainId !== 56 && network.chainId !== 97) {
      setStatus("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –º–µ—Ä–µ–∂–∞. –ü–µ—Ä–µ–º–∫–Ω—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å –Ω–∞ BNB Smart Chain (mainnet –∞–±–æ testnet).", "error");
      setWalletIndicator("warn", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –º–µ—Ä–µ–∂–∞");
      return false;
    }
    const netName = network.chainId === 56 ? "BNB Smart Chain (mainnet)" : "BNB Smart Chain Testnet";
    setWalletIndicator("ok", `–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${netName}`);
    return true;
  }

  async function initContracts() {
    tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, provider);
    faucetContract = new ethers.Contract(FAUCET_ADDRESS, FAUCET_ABI, provider);
  }

  async function loadFaucetParams() {
    try {
      rewardAmountBN = await faucetContract.rewardAmount();
      claimIntervalSec = (await faucetContract.claimInterval()).toNumber();
      isPaused = await faucetContract.isPaused();
      faucetBalanceBN = await faucetContract.faucetBalance();

      const rewardHuman = ethers.utils.formatUnits(rewardAmountBN, TOKEN_DECIMALS);
      faucetInfoEl.textContent =
        `–†–æ–∑–º—ñ—Ä –≤–∏–Ω–∞–≥–æ—Ä–æ–¥–∏: ${trimTo8Decimals(rewardHuman)} SHAG. ` +
        `–Ü–Ω—Ç–µ—Ä–≤–∞–ª –º—ñ–∂ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º–∏: ${Math.floor(claimIntervalSec / 3600)} –≥–æ–¥. `;

      if (faucetBalanceBN && !faucetBalanceBN.isZero()) {
        const fb = ethers.utils.formatUnits(faucetBalanceBN, TOKEN_DECIMALS);
        faucetInfoEl.textContent += `–ë–∞–ª–∞–Ω—Å Faucet: ${trimTo8Decimals(fb)} SHAG.`;
      } else {
        faucetInfoEl.textContent += "Faucet –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ —â–µ –Ω–µ –ø–æ–ø–æ–≤–Ω–µ–Ω–∏–π.";
      }
    } catch (e) {
      console.error(e);
      setStatus("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ Faucet. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞–¥—Ä–µ—Å—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.", "error");
    }
  }

  async function refreshUserState() {
    if (!userAddress || !faucetContract) return;

    try {
      const last = await faucetContract.lastClaimTime(userAddress);
      lastClaimTimeSec = last.toNumber();
    } catch (e) {
      lastClaimTimeSec = 0;
    }

    const nowSec = Math.floor(Date.now() / 1000);
    let elapsed = lastClaimTimeSec === 0 ? claimIntervalSec : nowSec - lastClaimTimeSec;
    if (elapsed < 0) elapsed = 0;

    const progress = Math.min(1, elapsed / claimIntervalSec);
    const scale = ethers.BigNumber.from(Math.floor(progress * 1e8));
    const earned = rewardAmountBN
      ? rewardAmountBN.mul(scale).div(ethers.BigNumber.from(1e8))
      : ethers.BigNumber.from(0);

    let earnedHuman = rewardAmountBN
      ? ethers.utils.formatUnits(earned, TOKEN_DECIMALS)
      : "0";
    earnedHuman = trimTo8Decimals(earnedHuman);

    counterValueEl.textContent = earnedHuman;
    progressFillEl.style.width = (progress * 100).toFixed(1) + "%";

    let canClaimFlag = false;
    try {
      canClaimFlag = await faucetContract.canClaim(userAddress);
    } catch (e) {
      canClaimFlag = false;
    }

    const remainingSec = Math.max(0, claimIntervalSec - elapsed);

    if (isPaused) {
      claimBtn.disabled = true;
      setStatus("Faucet —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–∞ –ø–∞—É–∑—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.", "warn");
    } else if (faucetBalanceBN && faucetBalanceBN.isZero()) {
      claimBtn.disabled = true;
      setStatus("Faucet –ø–æ—Ä–æ–∂–Ω—ñ–π. –û—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏ SHAG.", "warn");
    } else if (canClaimFlag) {
      claimBtn.disabled = false;
      setStatus("–î–æ—Å—Ç—É–ø–Ω–æ –¥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ 100 SHAG.", "ok");
    } else {
      claimBtn.disabled = true;
      setStatus("–©–µ –Ω–µ –º–∏–Ω—É–≤ —ñ–Ω—Ç–µ—Ä–≤–∞–ª 24 –≥–æ–¥–∏–Ω–∏ –∑ –º–∏–Ω—É–ª–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è.", "warn");
    }

    timerTextEl.textContent = "–î–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: " + formatTimeLeft(remainingSec);
  }

  function startMiningLoop() {
    if (miningTimer) clearInterval(miningTimer);
    miningTimer = setInterval(async () => {
      if (!userAddress || !faucetContract || !rewardAmountBN) return;
      const nowSec = Math.floor(Date.now() / 1000);
      let elapsed = lastClaimTimeSec === 0 ? claimIntervalSec : nowSec - lastClaimTimeSec;
      if (elapsed < 0) elapsed = 0;
      const progress = Math.min(1, elapsed / claimIntervalSec);

      const scale = ethers.BigNumber.from(Math.floor(progress * 1e8));
      const earned = rewardAmountBN
        ? rewardAmountBN.mul(scale).div(ethers.BigNumber.from(1e8))
        : ethers.BigNumber.from(0);

      let earnedHuman = rewardAmountBN
        ? ethers.utils.formatUnits(earned, TOKEN_DECIMALS)
        : "0";
      earnedHuman = trimTo8Decimals(earnedHuman);

      counterValueEl.textContent = earnedHuman;
      progressFillEl.style.width = (progress * 100).toFixed(1) + "%";

      const remainingSec = Math.max(0, claimIntervalSec - elapsed);
      timerTextEl.textContent = "–î–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è: " + formatTimeLeft(remainingSec);
    }, 1000);
  }

  connectBtn.addEventListener("click", async () => {
    try {
      const ok = await initProvider();
      if (!ok) return;

      const networkOk = await checkNetwork();
      if (!networkOk) return;

      const accounts = await provider.send("eth_requestAccounts", []);
      if (!accounts || accounts.length === 0) {
        setStatus("–ê–¥—Ä–µ—Å–∞ –≥–∞–º–∞–Ω—Ü—è –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–∞.", "error");
        return;
      }

      userAddress = accounts[0];
      signer = provider.getSigner();
      setWalletIndicator("ok", userAddress.slice(0, 6) + "..." + userAddress.slice(-4));

      await initContracts();
      await loadFaucetParams();
      await refreshUserState();
      startMiningLoop();
    } catch (e) {
      console.error(e);
      setStatus("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è –∞–±–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤.", "error");
    }
  });

  claimBtn.addEventListener("click", async () => {
    if (!userAddress || !faucetContract) return;
    try {
      claimBtn.disabled = true;
      setStatus("–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —É –≤–∞—à–æ–º—É –≥–∞–º–∞–Ω—Ü—ñ‚Ä¶", "warn");

      const faucetWithSigner = faucetContract.connect(signer);
      const tx = await faucetWithSigner.claim();
      setStatus("–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞, –æ—á—ñ–∫—É—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è‚Ä¶", "warn");

      await tx.wait();
      setStatus("–£—Å–ø—ñ—Ö! 100 SHAG –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à –≥–∞–º–∞–Ω–µ—Ü—å.", "ok");

      await loadFaucetParams();
      await refreshUserState();
    } catch (e) {
      console.error(e);
      setStatus("–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ –∞–±–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –º–µ—Ä–µ–∂—ñ —Ç–∞ –º–∞—î—Ç–µ –≥–∞–∑.", "error");
      await refreshUserState();
    }
  });
</script>
</body>
</html>
